<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Enterprise Grails - Spring Batch</title>

		<meta name="description" content="Batch processing in Grails with Spring Batch">
		<meta name="author" content="John Engelman">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/beige.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
            <div class="slides">
    <section data-background-image="https://s3.amazonaws.com/media-p.slid.es/uploads/jengels/images/49935/presentation_title_background.png" data-background-size="contain">
        <h1>
            <br>
        </h1>
<h1>Enterprise Grails</h1>
<div>
        <br>
    </div>
<div>Batch Processing in Grails with Spring Batch</div>
<div>
    <br>
</div>
<div>
<br>
</div>
<div>John Engelman</div>
<div>@johnrengelman</div>
<div>Principal Consultant, Object Partners</div>
</section>
<section>
    <section data-background-size="contain">
        <h2>What is Batch Processing?</h2>
<div>
        <br>
    </div>
</section>
<section>
    <h2 style="font-style: normal; font-variant: normal;">WHAT IS BATCH PROCESSING?</h2>
<div>
    <br>
</div>
<div>
<br>
</div>
<div>
<span style="font-size: 36.79442596435547px; font-style: italic; font-variant: normal; background-color: rgba(255, 255, 255, 0.0470588);">"Execution of a series of programs ("jobs") on a computer without manual intervention"&nbsp;</span>
</div>
<div>
<span style="font-size: 36.79442596435547px; font-style: italic; font-variant: normal; background-color: rgba(255, 255, 255, 0.0470588);">(Wikipedia)</span>
<br>
</div>
</section>
<section>
    <h2 style="font-style: normal; font-variant: normal;">WHAT IS BATCH PROCESSING?</h2>
<div>
    <br>
</div>
<div>
<br>
</div>
<div>
<span style="font-size: 36.79442596435547px; font-style: italic; font-variant: normal; background-color: rgba(255, 255, 255, 0.0470588);">"Time based events, periodic application of complex business rules processed repetitively across very large data sets, or integration of information that..requires formatting, validation, and processing in a transactional manner"&nbsp;</span>
</div>
<div>
<span style="font-size: 36.79442596435547px; font-style: italic; font-variant: normal; background-color: rgba(255, 255, 255, 0.0470588);">(Spring Source)</span>
<br>
</div>
</section>
</section>
<section>
    <section>
        <h2>Applications of Batch Processing</h2>
<div>
        <ul>
<li>Data import</li>
<ul>
<li>Extract - Transform - Load (ETL)</li>
<li>Data restore</li>
</ul>
<li>Data export</li>
<ul>
<li>Report Generation</li>
<li>Data transmission</li>
<li>Backups</li>
</ul>
<li>Data conversion/processing</li>
<li>Long running processes</li>
</ul>
    </div>
</section>
<section>
    <h2>Batch Processing Frameworks</h2>
<div>
    <ul>
<li>Cron</li>
<ul>
    <li>Actually a scheduler</li>
</ul>
<li>z/OS Mainframe</li>
<li>Spring Batch</li>
<li>bmap4j</li>
<li>Hadoop MapReduce</li>
</ul>
</div>
</section>
</section>
<section>
    <section>
        <h2>Spring Batch Features</h2>
<div>
        <ul>
<li>Item/Chunk Oriented Processing</li>
<li>Job Retry/Repeat</li>
<li>Various core reader/write implementations</li>
<li>Transaction Management</li>
<li>Exception Handling</li>
<li>
        <span>Chunking &amp; Partioning</span>
    </li>
<li>
    <span>Meta-Data Persistence</span>
</li>
<li>
<span>Based on Spring Framework</span>
</li>
<li>
<span>Job &amp; Step Attribution Binding</span>
</li>
<li>
<span>XML/Annotation configuration&nbsp;</span>
</li>
</ul>
</div>
</section>
<section>
    <h2>anatomy of a Spring Batch Job</h2>
<h3>
    <u>Job</u>
</h3>
<div>
<ul>
<li style="text-align: left;">Encapsulates the batch process</li>
<li style="text-align: left;">Consists of at least 1&nbsp;<u>Step</u>
</li>
</ul>
<div style="text-align: left;">
<u>
<br>
</u>
</div>
</div>
<h3>
<u>Step</u>
</h3>
<div>
<ul>
<li>Encapsulates a single (simple or complex) task within the batch process</li>
<li>Has exactly 1 ItemReader &amp; 1 ItemWriter</li>
<li>Optionally has 1 ItemProcessor</li>
</ul>
</div>
</section>
<section>
    <h2 style="font-style: normal; font-variant: normal;">ANATOMY OF A SPRING BATCH JOB</h2>
<div>
<ul>
<li>Job Parameters</li>
<ul>
    <li>The input data to configure/execute the job</li>
</ul>
<li>JobInstance</li>
<ul>
<li>The execution of a Job for given set of JobParameters</li>
<li>JobInstance = Job + JobParameters</li>
</ul>
<li>JobExecution</li>
<ul>
<li>A single attempt at executing a JobInstance</li>
<li>Many executions for a single instance</li>
<li>Instance is complete when an execution completes&nbsp;</li>
</ul>
<li>StepExecution</li>
<ul>
<li>A single attempt at executing a Step within a Job.&nbsp;</li>
</ul>
</ul>
<pre>[http://www.slideshare.net/gschmutz/spring-batch-20-2794015]</pre>
</div></section><section><h2 style="font-style: normal; font-variant: normal;">ANATOMY OF A SPRING BATCH JOB</h2>
<div>
<img src="https://raw.github.com/SpringSource/spring-batch/master/src/site/docbook/reference/images/jobHeirarchyWithSteps.png"><br>
</div>
<pre>[https://raw.github.com/SpringSource/spring-batch/master/src/site/docbook/reference/images/jobHeirarchyWithSteps.png]</pre></section><section><h2 style="font-style: normal; font-variant: normal;">ANATOMY OF A SPRING BATCH JOB</h2>
<h3>
    <u>ItemReader</u>
</h3>
<div>
    <ul>
<li>API for retrieving input data for a step</li>
        <li>Retrieves 1 item at a time</li>
        <li>Returns null when input is exhausted</li>
    </ul>
<div style="text-align: left;">
<pre><code><font style="font-size: 24px;">package org.springframework.batch.item;

public interface ItemReader&lt;T&gt; {

    T read() throws Exception, UnexpectedInputException, ParseException, NonTransientResourceException;

} </font></code></pre>
</div>
</div>


</section>
<section>
<h2 style="font-style: normal; font-variant: normal;">ANATOMY OF A SPRING BATCH JOB</h2>
<h3>
    <u>ItemProcessor</u>
</h3>
<div>
    <ul>
<li>API for transforming/processing input item to output item</li>
        <li>Processes 1 item at a time</li>
        <li>Returns null to indicate that result should not be saved</li>
    </ul>
<div style="text-align: left;">
<pre><code><font style="font-size: 24px;">package org.springframework.batch.item;

public interface ItemProcessor&lt;I, O&gt; {

    O process(I i) throws Exception;

} </font></code></pre>
</div>
</div>



</section>
<section>
    <h2 style="font-style: normal; font-variant: normal;">ANATOMY OF A SPRING BATCH JOB</h2>
<h3>
    <u>ItemWriter</u>
</h3>
<div>
    <ul>
<li>API representing output of Step</li>
        <li>Chunk-Oriented</li>
<ul>
    <li>Transaction is committed for a series of ItemWriter calls</li>
</ul>
<li>Receives a List of read or processed items</li>
<ul>
<li>List size is size of commit-interval</li>
</ul>
</ul>
<div style="text-align: left;">
<pre><code><font style="font-size: 24px;">package org.springframework.batch.item;

public interface ItemWriter&lt;T&gt; {

    void write(List&lt;? extends T&gt; items) throws Exception;

} </font></code></pre>
</div>
</div>




</section>
<section>
    <h2 style="font-style: normal; font-variant: normal;">ANATOMY OF A SPRING BATCH JOB</h2>
<div>
    <br>
</div>
<div>
<img src="https://raw.github.com/SpringSource/spring-batch/master/src/site/docbook/reference/images/chunk-oriented-processing.png">
<br>
</div>
<pre>[https://raw.github.com/SpringSource/spring-batch/master/src/site/docbook/reference/images/chunk-oriented-processing.png]<br></pre>
</section>
<section>
    <h2 style="font-style: normal; font-variant: normal;">ANATOMY OF A SPRING BATCH JOB</h2>
<div>
    <ul>
<li>Listeners</li>
<ul>
<li>JobExecution, StepExecution, ChunkExecution</li>
<li>ItemReader, ItemWrite, ItemProcessor</li>
<li>Skips</li>
</ul>
<li>Exception Handling</li>
<ul>
    <li>Skip, Retry, Rollback</li>
</ul>
<li>JobParameters Validation</li>
<li>Flow Control</li>
<ul>
<li>Sequential, Parallel, Conditional, etc.</li>
</ul>
</ul>
</div>
</section>
</section>
<section>
    <section>
        <h2>Provided Readers</h2>
<div>
<ul>
<li>Ampq</li>
<li>MongoDB, Neo4j, Spring Data Repository (as of v2.2.0)</li>
<li>Hibernate Cursor</li>
<li>Hibernate Paging</li>
<li>Ibatis Paging&nbsp;</li>
<li>JDBC Cursor</li>
<li>JDBC Paging</li>
<li>JPA Paging</li>
<li>Stored Procedure</li>
<li>Flat File</li>
<li>Spring Resource</li>
<li>JMS</li>
<li>StAX Event</li>
</ul>
</div>

</section>
        <section>
            <h2>Provided Writers</h2>
<div>
<ul>
<li>Ampq</li>
<li>MongoDB, Neo4j, Spring Data Repository (as of v2.2.0)</li>
<li>Gemfire (as of v2.2.0)</li>
<li>Hibernate&nbsp;</li>
<li>Ibatis Batch&nbsp;</li>
<li>JDBC Batch</li>
<li>
<span>JPA</span>
</li>
<li>
<span>Flat File</span>
</li>
<li>
<span>Simple Mail</span>
</li>
<li>
<span>MIME Message</span>
</li>
<li>StAX Event</li>
</ul>
</div>
</section>
        </section>
        <section>
            <section>
<h2>JSR-352</h2>
<h2>Batch Applications for the java Platform</h2>
<div>
<ul>
<li>v1.0 Final Release - May 24, 2013</li>
<li>Designed for both Java SE and Java EE platforms</li>
<li>Requires Java 6+</li>
<li>Designed with DI in mind without specifying a DI implementation</li>
<li>Based on the Chunk-Oriented Processing and Reader-Processor-Writer patterns of Spring Batch</li>
</ul>
<pre> [http://jcp.org/aboutJava/communityprocess/final/jsr352/index.html]<br>            </pre>
</div>
        </section>
        <section>
            <h2>Differences?</h2>
<div>
<ul>
<li>JSR-352<i>&nbsp;batchlet</i>&nbsp;=&gt; Spring Batch <i>tasklet</i>
</li>
<ul>
            <li>Typically non-item-oriented tasks</li>
</ul>
<li>JSR-352 requires Job XML documents in META-INF/batch-jobs</li>
<li>JSR-352 item count or time based commit-intervals</li>
<li>JSR-352 batchlet and chunk are mutually exclusive, Spring Batch chunk is encapsulated by tasklet</li>
</ul>
<pre>[http://www.infoq.com/news/2013/06/ee7-spring-batch]</pre>
</div></section></section><section><section><h2>Grails Spring Batch</h2>
<div><div style="text-align: left;"><br></div></div>
<div style="text-align: left;"><ul>
<li>Current Version: 1.0</li>
<li>Github URL: <a href="http://github.com/johnrengelman/grails-spring-batch">http://github.com/johnrengelman/grails-spring-batch</a>
</li>
<li>Spring Batch v2.1.9.RELEASE</li>
<li>Spring Batch Admin v1.2.2.RELEASE</li>
<li>Compatible with Grails 2.x+</li>
</ul></div></section><section><h2>Features</h2>
<div><ul>
<li>Defined job definitions using Spring BeanBuilder Groovy syntax</li>
<li>Automatic detection of batch configuration files (grails-app/batch)</li>
<li>Automatic configuration reloading during development</li>
<li>JMX integration</li>
<li>Automatic deployment of Spring Batch DDL</li>
<ul><li>Specify the database type</li></ul>
<li>UI Services for providing access to Spring Batch data</li>
<li>Base views that mimic Spring Batch Admin views</li>
</ul></div></section></section><section><section><h2>Installing Plugin</h2>
<div style="text-align: left; ">Add to BuildConfig.groovy in 'plugins' section</div>
<pre><code> compile ":spring-batch:1.0"</code>        </pre>
<br>
    </section>
    <section>
        <h2>Configuring Plugin</h2>
<div style="text-align: left; ">
        <ul>
<li>
<span>Every configuration value has sane default for simple application.</span>
        <br>
</li>
<li>
<span>Modify configuration in Config.groovy</span>
        <br>
</li>
</ul>
</div>
<pre><code>plugin {</code><code>  springBatch {</code><code>    database = 'mysql'</code><code>    loadTables = false</code><code>  }</code><code>}</code><code><br></code><code>environments {</code><code>  test {</code><code>    plugin.springBatch.database = 'h2'</code><code>    plugin.springBatch.loadTables = true</code><code><span style="font-family: monospace;">  }</span></code><code><span style="font-family: monospace;">}   </span></code>    </pre>
</section>
<section>
<h2>Configuring the DataSource</h2>
<div style="text-align: left; ">
<ul>
<li>Specify which datasource to use in multi-database application</li>
</ul>
<pre><code>plugin.springBatch.dataSource = 'batchDataSource' </code></pre>
<ul>
<ul>
<li>Be aware of &nbsp;cross datasource transactions when using this mode. No XA management by default in Grails</li>
</ul>
<li>Specify a prefix for Spring Batch tables</li>
</ul>
<pre><code>plugin.springBatch.tablePrefix = 'SPRINGBATCH_' </code></pre>
<ul>
<ul>
    <li>All spring batch tables are in UPPERCASE. Be aware for case sensitive DBs &amp; File Systems</li>
</ul>
</ul>
</div>
</section>
</section>
<section>
    <section>
<h2>Defining Batch Jobs</h2>
<div style="text-align: left; ">
    <ul>
<li>Define jobs in 'grails-app/batch'</li>
        <li>Files end with BatchConfig.groovy</li>
    </ul>
<pre><code>grails-app/batch/SimpleJobBatchConfig.groovy</code>    </pre>
</div>

</section>
    <section>
<h2>Defining Batch Jobs</h2>
<div style="text-align: left; ">
    <ul>
<li>Define jobs in 'grails-app/batch'</li>
        <li>Files end with BatchConfig.groovy</li>
    </ul>
<pre><code>grails-app/batch/SimpleJobBatchConfig.groovy </code>    </pre>
<ul>
<li>Wrap definition with a 'beans' closure</li>
</ul>
<div>
    <pre style="font-style: normal; font-variant: normal; width: 861.9073486328125px;">
    <code>
        <font color="#ff0000">beans</font> {
}</code>
    </pre>
</div>
</div>


</section>
    <section>
<h2>Defining Batch Jobs</h2>
<div style="text-align: left; ">
    <ul>
<li>Define jobs in 'grails-app/batch'</li>
        <li>Files end with BatchConfig.groovy</li>
    </ul>
<pre><code>grails-app/batch/SimpleJobBatchConfig.groovy </code>    </pre>
<ul>
<li>Wrap definition with a 'beans' closure</li>
</ul>
<div>
    <pre style="font-style: normal; font-variant: normal; width: 861.9073486328125px;">
    <code>
        <font color="#ff0000">beans</font> {
}</code>
</pre>
</div>
<ul>
<li>Define jobs using the 'batch' prefix</li>
    </ul>
<pre><code>beans {</code><code>  <font color="#ff0000">batch.job</font>(id: 'simpleJob') {</code><code>   <font color="#ff0000"> batch.step</font>(id: 'logStart') {</code><code><span style="font-family: monospace;">      ...</span></code><code><span style="font-family: monospace;">    }</span></code><code><span style="font-family: monospace;">  }</span></code><code><span style="font-family: monospace;">} </span></code>    </pre>
</div>




</section>
    <section>
        <h2>Defining Batch Jobs</h2>
<div style="text-align: left; ">
        <ul>
            <li>Utilize Grails service by autowiring them into Job components</li>
        </ul>
</div>
<pre><code>beans {</code><code>  batch.job(id: 'simpleJob')</code><code>    batch.step(id: 'logStart') {</code><code>      batch.tasklet(ref: 'logStart')</code><code>    }</code><code>  }</code><code><span style="font-family: monospace;"><br></span></code><code><span style="font-family: monospace;">  logStart(PrintStartMessageTasklet) { bean -&gt;</span></code><code><span style="font-family: monospace;">    bean.autowire = 'byName'</span></code><code><span style="font-family: monospace;">  }</span></code><code><span style="font-family: monospace;">} </span></code>    </pre>
</section>
</section>
<section>
    <section>
<h2>Executing Batch Jobs</h2>
<div style="text-align: left; ">
<ul>
<li>Plugin automatically registers a JobLauncher Spring bean</li>
<li>Each Job is also registered as a Spring bean</li>
<li>Use Grails DI to access and call</li>
</ul>
<pre><code><span>class SimpleJobService {</span><br></code><code>  JobLauncher jobLauncher //registered by plugin</code><code>}</code>    </pre>
</div>
</section>
<section>
<h2>Executing Batch Jobs</h2>
<div style="text-align: left; ">
    <ul>
<li>Plugin automatically registers a JobLauncher Spring bean</li>
        <li>Each Job is also registered as a Spring bean</li>
        <li>Use Grails DI to access and call</li>
    </ul>
<pre><code><span>class SimpleJobService {</span><br></code><code>  JobLauncher jobLauncher //registered by plugin</code><code>  Job simpleJob //registered by defining the Job</code><code>}</code></pre>
</div>
</section>
<section>
<h2>Executing Batch Jobs</h2>
<div style="text-align: left; ">
    <ul>
<li>Plugin automatically registers a JobLauncher Spring bean</li>
        <li>Each Job is also registered as a Spring bean</li>
        <li>Use Grails DI to access and call</li>
    </ul>
<pre><code><span>class SimpleJobService {</span><br></code><code>  JobLauncher jobLauncher //registered by plugin</code><code>  Job simpleJob //registered by defining the Job</code><code><br></code><code>  Long execute() {</code><code>  }</code><code>}</code></pre>
</div>

</section>
<section>
<h2>Executing Batch Jobs</h2>
<div style="text-align: left; ">
    <ul>
<li>Plugin automatically registers a JobLauncher Spring bean</li>
        <li>Each Job is also registered as a Spring bean</li>
        <li>Use Grails DI to access and call</li>
    </ul>
<pre><code><span>class SimpleJobService {</span><br></code><code>  JobLauncher jobLauncher //registered by plugin</code><code>  Job simpleJob //registered by defining the Job</code><code><br></code><code>  Long execute() {</code><code>    JobParametersBuilder builder = new JobParametersBuilder()</code><code>    builder.addString('baseMessage', 'some base text')</code><code>  }</code><code>}</code></pre>
</div>

</section>
<section>
<h2>Executing Batch Jobs</h2>
<div style="text-align: left; ">
    <ul>
<li>Plugin automatically registers a JobLauncher Spring bean</li>
        <li>Each Job is also registered as a Spring bean</li>
        <li>Use Grails DI to access and call</li>
    </ul>
<pre><code><span>class SimpleJobService {</span><br></code><code>  JobLauncher jobLauncher //registered by plugin</code><code>  Job simpleJob //registered by defining the Job</code><code><br></code><code>  Long execute() {</code><code>    JobParametersBuilder builder = new JobParametersBuilder()</code><code>    builder.addString('baseMessage', 'some base text')</code><code><br></code><code>    JobExecution jobExecution =&nbsp;</code><code>      jobLauncher.run(simpleJob, builder.toJobParameters()</code><code>    return jobExecution.jobId</code><code>  }</code><code>}</code></pre>
</div>

</section>
</section>
<section>
    <h2>
        <br>
        </h2>
<h2>
<span>Sample Application</span>
        <br>
</h2>
<div>
        <span>
            <br>
        </span>
    </div>
<pre style="text-align: center; ">
    <span>Based on Spring Batch Football
</span>
    <a href="https://github.com/spring-projects/spring-batch/blob/master/spring-batch-samples/src/main/resources/jobs/footballJob.xml">https://github.com/spring-projects/spring-batch/blob/master/spring-batch-samples/src/main/resources/jobs/footballJob.xml</a>
    <br>
</pre>
<br>
</section>
<section>
    <h2>Plugin Roadmap</h2>
<div>
    <ul>
<li>Spring Batch 2.2.0.RELEASE</li>
<ul>
    <li>Requires minimum Grails v2.1.1</li>
</ul>
<li>Drive towards Spring Batch annotations and builder patterns</li>
<li>Binary releases</li>
<li>Verification with Grails 2.3</li>
</ul>
</div>
</section>
</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
